---
// SSR mode - getStaticPaths required for dynamic routes even in SSR mode
export const prerender = false;

export async function getStaticPaths() {
	return [
		{ params: { lang: 'en' } },
		{ params: { lang: 'es' } },
	];
}

import Layout from '../../layouts/Layout.astro';
import Navbar from '../../components/Navbar.astro';
import Hero from '../../components/Hero.astro';
import AsideSection from '../../components/AsideSection.astro';
import ServicesSection from '../../components/ServicesSection.astro';
import CompaniesSection from '../../components/CompaniesSection.astro';
import Testimonial from '../../components/Testimonial.astro';
import CaseStudy from '../../components/CaseStudy.astro';
import OfferSection from '../../components/OfferSection.astro';
import BlogSection from '../../components/BlogSection.astro';
import Footer from '../../components/Footer.astro';
import ContactModal from '../../components/ContactModal.astro';
import TestimonialSchema from '../../components/TestimonialSchema.astro';
import { useTranslations } from '../../i18n/utils';
import { getTestimonialsByLang } from '../../data/testimonials';

// Import images for testimonials and case studies
import SeanHeadshot from '../../assets/images/Sean-Headshot.png';
import AndyHeadshot from '../../assets/images/Andy-Headshot.png';
import TourialScreenshots from '../../assets/images/Tourial-Screenshots.png';

const { lang } = Astro.params || { lang: 'en' };

// Ignore StudioCMS routes - they should not be captured by i18n
// Return 404 immediately if lang is not a valid locale
if (lang && typeof lang === 'string' && !['en', 'es'].includes(lang)) {
	return new Response(null, {
		status: 404,
		statusText: 'Not Found',
	});
}

const t = useTranslations(lang as 'en' | 'es');
const testimonials = getTestimonialsByLang(lang as 'en' | 'es');

// SEO keywords for homepage
const keywords = t('homepage.seo.keywords');
const title = t('homepage.seo.title');
const description = t('homepage.seo.description');
---

<Layout keywords={keywords} title={title} description={description} lang={lang}>
	<Navbar lang={lang} />
	<main id="main-content">
		<Hero lang={lang} />

		<AsideSection lang={lang} />

		<ServicesSection lang={lang} />

		<CompaniesSection lang={lang} />

		<Testimonial
			image={SeanHeadshot}
			quote={testimonials[0].quote}
			author={testimonials[0].author}
			position={testimonials[0].position}
			company={testimonials[0].company}
		/>
		<TestimonialSchema
			author={testimonials[0].author}
			position={testimonials[0].position}
			company={testimonials[0].company}
			quote={testimonials[0].quote}
		/>

		<CaseStudy
			image="https://uploads-ssl.webflow.com/5f1aca38cd9acd41a07b69f5/6115a548caa9f623017a1227_LoanShout%20Screenshots.png"
			title={t('caseStudies.loanshout.title')}
			description={t('caseStudies.loanshout.description')}
			linkText={t('common.readMore')}
			linkUrl="#"
			imageAlt={t('caseStudies.loanshout.imageAlt')}
		/>

		<OfferSection lang={lang} />

		<CaseStudy
			image={TourialScreenshots}
			title={t('caseStudies.tourial.title')}
			description={t('caseStudies.tourial.description')}
			linkText={t('common.readMore')}
			linkUrl="#"
			imageAlt={t('caseStudies.tourial.imageAlt')}
		/>

		<Testimonial
			image={AndyHeadshot}
			quote={testimonials[1].quote}
			author={testimonials[1].author}
			position={testimonials[1].position}
			company={testimonials[1].company}
		/>
		<TestimonialSchema
			author={testimonials[1].author}
			position={testimonials[1].position}
			company={testimonials[1].company}
			quote={testimonials[1].quote}
		/>

		<BlogSection lang={lang} />
	</main>

	<Footer lang={lang} />

	<ContactModal lang={lang} />
</Layout>

<style is:global>
	/* Additional styles for specific elements */
	.blog-grid {
		display: grid;
		grid-template-columns: repeat(3, 1fr);
		gap: 32px;
	}

	.blog-feed-post-wrapper {
		text-align: left;
		flex-direction: column;
		align-items: flex-start;
		display: flex;
	}

	.blog-feed-image {
		object-fit: cover;
		border-radius: 8px;
		width: 100%;
		height: 240px;
		margin-bottom: 0;
	}

	.blog-feed-details {
		align-items: center;
		display: flex;
	}

	.blog-feed-text {
		color: var(--grey-3);
	}

	.divider {
		background-color: var(--grey-3);
		width: 2px;
		height: 16px;
		margin-left: 8px;
		margin-right: 8px;
	}

	.text-link {
		color: var(--pimento);
		font-weight: 700;
		transition: opacity 0.2s cubic-bezier(0.645, 0.045, 0.355, 1);
		text-decoration: none;
	}

	.text-link:hover {
		opacity: 0.65;
	}

	.text-span-4 {
		font-weight: 600;
	}

	.success-message,
	.error-message {
		display: none;
		padding: 16px;
		border-radius: 4px;
		margin-top: 16px;
	}

	.success-message {
		background-color: var(--green-100);
		color: var(--green-900);
		border: 1px solid var(--green-500);
	}

	.error-message {
		background-color: var(--cinnamon-100);
		color: var(--cinnamon-500);
		border: 1px solid var(--cinnamon-500);
	}

	@media (max-width: 768px) {
		.grid-5 .div-block-35,
		.grid-5 .div-block-36 {
			display: none;
		}

		.blog-grid {
			grid-template-columns: 1fr;
			gap: 40px;
		}

		.blog-feed-post-wrapper {
			max-width: 100%;
		}

		.blog-feed-image {
			height: 200px;
		}
	}

	@media (max-width: 480px) {
		.blog-grid {
			gap: 32px;
		}

		.blog-feed-image {
			height: 180px;
		}

		.blog-feed-text {
			font-size: 14px;
		}
	}
</style>
