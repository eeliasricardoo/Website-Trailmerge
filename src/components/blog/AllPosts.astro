---
import { useTranslations } from '../../i18n/utils';

import type { BlogPost } from '../../types/blog';

export interface Props {
	lang?: string;
	posts: BlogPost[];
}

const { lang = 'en', posts = [] } = Astro.props;
const t = useTranslations(lang as 'en' | 'es');

// Get all posts except the first 4 (which are featured)
const allPosts = posts.slice(4);
---

<!-- All Posts Section -->
<section class="all-posts-wrapper">
	<div class="all-posts-container">
		<h2 class="section-title">{t('blog.allPosts')}</h2>
		<div class="all-posts-list">
			{
				allPosts.map((post) => (
					<article class="post-item">
						<a href={`/${lang}/blog/${post.slug}/`} class="post-link">
							<div class="post-image-wrapper">
								<img
									src={post.image}
									alt={post.imageAlt || post.title}
									class="post-image"
									loading="lazy"
								/>
							</div>
							<div class="post-content">
								<h3 class="post-title">{post.title}</h3>
								<div class="post-meta">
									<span class="post-date">{post.date}</span>
									{post.author && <span class="post-author"> â€¢ {post.author.name}</span>}
								</div>
								<div class="post-excerpt-wrapper">
									<p class="post-excerpt">{post.excerpt}</p>
									<span class="post-read-more">{t('common.readMore')}</span>
								</div>
							</div>
						</a>
					</article>
				))
			}
		</div>
	</div>
</section>

<style>
	.all-posts-wrapper {
		width: 100%;
		padding: 0 20px 160px 20px;
		background-color: transparent;
		display: flex;
		justify-content: center;
		position: relative;
		z-index: 10;
		overflow: hidden;
	}

	.all-posts-container {
		width: 100%;
		max-width: 1200px;
	}

	.section-title {
		color: var(--brand-secondary-brown);
		font-family: 'Young Serif', serif;
		font-size: 56px;
		font-weight: 400;
		line-height: 1.2;
		margin: 0 0 38px 0;
	}

	.all-posts-list {
		display: flex;
		flex-direction: column;
		gap: 40px;
	}

	.post-item {
		width: 100%;
	}

	.post-link {
		text-decoration: none;
		color: inherit;
		display: flex;
		gap: 32px;
		align-items: flex-start;
		transition: transform 0.3s ease;
	}

	.post-link:hover {
		transform: translateY(-2px);
	}

	.post-image-wrapper {
		width: 300px;
		min-width: 300px;
		aspect-ratio: 3/2;
		border-radius: 8px;
		overflow: hidden;
		box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
	}

	.post-image {
		width: 100%;
		height: 100%;
		object-fit: cover;
	}

	.post-content {
		display: flex;
		flex-direction: column;
		gap: 12px;
		flex: 1;
	}

	.post-title {
		color: var(--brand-secondary-brown);
		font-family: 'Young Serif', serif;
		font-size: 28px;
		font-weight: 400;
		line-height: 1.3;
		margin: 0;
	}

	.post-meta {
		color: var(--brand-secondary-brown);
		font-family: 'DM Sans', sans-serif;
		font-size: 16px;
		font-weight: 400;
		line-height: 1.5;
	}

	.post-excerpt-wrapper {
		display: flex;
		align-items: flex-start;
		gap: 8px;
		min-height: calc(18px * 1.6 * 3); /* Ensure 3 lines fixed vertical space */
	}

	.post-excerpt {
		color: var(--brand-secondary-brown);
		font-family: 'DM Sans', sans-serif;
		font-size: 18px;
		font-weight: 400;
		line-height: 1.6;
		margin: 0;
		flex: 1;
		display: -webkit-box;
		-webkit-line-clamp: 3;
		/* autoprefixer: ignore next */
		-webkit-box-orient: vertical;
		overflow: hidden;
		text-overflow: ellipsis;
		max-height: calc(18px * 1.6 * 3); /* Force maximum height of 3 lines */
	}

	.post-read-more {
		color: var(--brand-secondary-brown);
		font-family: 'DM Sans', sans-serif;
		font-size: 16px;
		font-weight: 600;
		text-decoration: underline;
		white-space: nowrap;
		flex-shrink: 0;
		align-self: flex-end;
		line-height: 1.6;
		padding-bottom: 2px;
	}

	@media (max-width: 1024px) {
		.post-image-wrapper {
			width: 250px;
			min-width: 250px;
		}
	}

	@media (max-width: 768px) {
		.all-posts-wrapper {
			padding: 32px 20px 60px;
		}

		.section-title {
			font-size: 40px;
			margin-bottom: 40px;
		}

		.all-posts-list {
			gap: 32px;
		}

		.post-link {
			flex-direction: column;
			gap: 20px;
		}

		.post-image-wrapper {
			width: 100%;
			min-width: 100%;
		}

		.post-title {
			font-size: 24px;
		}

		.post-excerpt {
			font-size: 16px;
			max-height: calc(16px * 1.6 * 3);
		}

		.post-excerpt-wrapper {
			min-height: calc(16px * 1.6 * 3);
		}
	}

	@media (max-width: 480px) {
		.all-posts-wrapper {
			padding: 48px 16px;
		}

		.section-title {
			font-size: 36px;
		}

		.post-title {
			font-size: 22px;
		}
	}
</style>
