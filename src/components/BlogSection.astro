---
import { useTranslations } from '../i18n/utils';
import { getAllPosts } from '../data/blogPosts';
import { getAllPostsEs } from '../data/blogPosts-es';
import OptimizedImage from './OptimizedImage.astro';

export interface BlogPost {
	image: string;
	title: string;
	author: string;
	date: string;
	linkUrl?: string;
	imageAlt?: string;
}

export interface Props {
	posts?: BlogPost[];
	lang?: string;
}

const { lang = 'en' } = Astro.props;
const t = useTranslations(lang as 'en' | 'es');

// Get the latest 3 blog posts from the data file
const allBlogPosts = lang === 'es' ? getAllPostsEs() : getAllPosts();
const langPrefix = lang === 'es' ? '/es' : '/en';
const latestPosts = allBlogPosts.slice(0, 3).map((post) => ({
	image: post.image,
	title: post.title,
	author: post.author.name,
	date: post.date,
	linkUrl: `${langPrefix}/blog/${post.slug}/`,
	imageAlt: post.imageAlt,
}));

const { posts = latestPosts } = Astro.props;
---

<!-- Blog Section -->
<div class="body-block">
	<div class="content-container">
		<div class="blog-grid">
			{
				posts.map((post) => (
					<div class="blog-feed-post-wrapper">
						<OptimizedImage
							src={post.image}
							alt={post.imageAlt || post.title}
							class="blog-feed-image"
							width={400}
							height={300}
							widths={[400, 600, 800]}
							sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 400px"
							loading="lazy"
						/>
						<div class="spacer-m" />
						<h4>{post.title}</h4>
						<div class="spacer-s" />
						<div class="blog-feed-details">
							<div class="blog-feed-text">{post.author}</div>
							<div class="divider" />
							<div class="blog-feed-text">{post.date}</div>
						</div>
						<div class="spacer-xs" />
						<a href={post.linkUrl || '#'} class="text-link">
							{t('blog.seePost')}
						</a>
					</div>
				))
			}
		</div>
	</div>
</div>
