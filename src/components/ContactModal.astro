---
import { useTranslations } from '../i18n/utils';
import CoffeeImage from '../assets/images/Coffee.png';

export interface Props {
	image?: any;
	title?: string;
	description?: string;
	lang?: string;
}

const { lang = 'en' } = Astro.props;
const t = useTranslations(lang as 'en' | 'es');

const {
	image = CoffeeImage,
	title = t('contact.title'),
	description = t('contact.description')
} = Astro.props;

// Copper form URLs based on language
const copperFormUrl = lang === 'es'
	? 'https://forms.copper.com/j/wYsDRF6aDG9YgnPCCJjiXJ?type=embed'
	: 'https://forms.copper.com/j/5dNTzeqzanj9McnokQfpFq?type=embed';

const copperFormId = lang === 'es'
	? 'wYsDRF6aDG9YgnPCCJjiXJ'
	: '5dNTzeqzanj9McnokQfpFq';
---

<!-- Contact Modal -->
<div class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="modal-title">
	<div class="contact-modal">
		<div class="modal-columns">
			<div class="modal-column centered">
				<img src={image.src} loading="lazy" alt="Coffee cup illustration representing consultation meeting" class="modal-image" />
				<h3 id="modal-title">{title}</h3>
				<p>{description}</p>
			</div>
			<div class="modal-column">
				<div class="form-block copper-form-container">
					<iframe
						src={copperFormUrl}
						id={copperFormId}
						title="Embedded Copper Forms"
						width="100%"
						height="700"
						style="border: none; min-height: 700px;"
						loading="lazy"
					></iframe>
				</div>
			</div>
		</div>
		<button class="close-modal" aria-label={t('contact.form.closeButton')}>✕</button>
	</div>
</div>

<script>
	// Modal functionality
	document.addEventListener('DOMContentLoaded', function() {
		const modalBackdrop = document.querySelector('.modal-backdrop');
		const openModalButtons = document.querySelectorAll('.open-modal');
		const closeModalButton = document.querySelector('.close-modal');

		if (!modalBackdrop || !closeModalButton) return;

		// Open modal
		openModalButtons.forEach(button => {
			button.addEventListener('click', function(e) {
				e.preventDefault();
				modalBackdrop.classList.add('active');
				document.body.style.overflow = 'hidden';
			});
		});

		// Close modal
		closeModalButton.addEventListener('click', function(e) {
			e.preventDefault();
			modalBackdrop.classList.remove('active');
			document.body.style.overflow = 'auto';
		});

		// Close modal when clicking backdrop
		modalBackdrop.addEventListener('click', function(e) {
			if (e.target === modalBackdrop) {
				modalBackdrop.classList.remove('active');
				document.body.style.overflow = 'auto';
			}
		});

		// Close modal with Escape key
		document.addEventListener('keydown', function(e) {
			if (e.key === 'Escape' && modalBackdrop.classList.contains('active')) {
				modalBackdrop.classList.remove('active');
				document.body.style.overflow = 'auto';
			}
		});
	});
</script>

<style>
	/* Modal backdrop com scroll */
	.modal-backdrop {
		overflow-y: auto;
		overflow-x: hidden;
		display: flex;
		align-items: flex-start;
		justify-content: center;
		padding: 3vh 1rem;
	}

	.copper-form-container {
		width: 100%;
		overflow: hidden;
	}

	.copper-form-container iframe {
		width: 100%;
		border: none;
		height: 700px;
		min-height: 700px;
		max-height: 700px;
	}

	/* Ajustar altura do modal para acomodar o iframe */
	.contact-modal {
		max-height: none;
		height: fit-content;
		overflow: visible;
		padding: 2rem;
		margin: auto;
	}

	/* Ajustar colunas do modal */
	.modal-columns {
		display: grid;
		grid-template-columns: 1fr 1.2fr;
		gap: 3rem;
		align-items: start;
	}

	/* Centralizar imagem e conteúdo */
	.modal-column.centered {
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
		text-align: center;
		padding: 2rem 1rem;
	}

	.modal-column.centered .modal-image {
		margin: 0 auto 2rem;
		display: block;
		max-width: 280px;
		width: 100%;
		height: auto;
	}

	.modal-column.centered h3 {
		margin-bottom: 1rem;
		font-size: 1.75rem;
		line-height: 1.3;
	}

	.modal-column.centered p {
		margin: 0;
		font-size: 1rem;
		line-height: 1.6;
		max-width: 350px;
	}

	/* Ajustar coluna do formulário */
	.modal-column {
		height: 700px;
	}

	.modal-column.centered {
		height: auto;
	}

	/* Botão de fechar */
	.close-modal {
		position: absolute;
		top: 1.5rem;
		right: 1.5rem;
		width: 40px;
		height: 40px;
		display: flex;
		align-items: center;
		justify-content: center;
		font-size: 1.5rem;
		transition: transform 0.2s ease;
	}

	.close-modal:hover {
		transform: scale(1.1);
	}

	@media (max-width: 991px) {
		.modal-columns {
			grid-template-columns: 1fr;
			gap: 2rem;
		}

		.contact-modal {
			padding: 1.5rem;
			max-height: none;
			overflow: visible;
		}

		.modal-column.centered {
			padding: 1rem;
		}

		.modal-column.centered .modal-image {
			max-width: 200px;
			margin-bottom: 1.5rem;
		}

		.modal-column.centered h3 {
			font-size: 1.5rem;
		}

		.modal-column {
			min-height: auto;
		}
	}

	@media (max-width: 768px) {
		.copper-form-container iframe {
			height: 600px;
			min-height: 600px;
			max-height: 600px;
		}

		.modal-column {
			height: 600px;
		}

		.close-modal {
			top: 1rem;
			right: 1rem;
			width: 36px;
			height: 36px;
		}
	}

	@media (max-width: 479px) {
		.contact-modal {
			padding: 1rem;
		}

		.modal-column.centered .modal-image {
			max-width: 160px;
			margin-bottom: 1rem;
		}

		.modal-column.centered h3 {
			font-size: 1.25rem;
			margin-bottom: 0.75rem;
		}

		.modal-column.centered p {
			font-size: 0.9rem;
		}

		.copper-form-container iframe {
			height: 550px;
			min-height: 550px;
			max-height: 550px;
		}

		.modal-column {
			height: 550px;
		}
	}
</style>
