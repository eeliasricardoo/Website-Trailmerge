---
import { useTranslations } from '../i18n/utils';
import CoffeeImage from '../assets/images/Coffee.png';

export interface Props {
	image?: any;
	title?: string;
	description?: string;
	formAction?: string;
	formMethod?: string;
	lang?: string;
}

const { lang = 'en' } = Astro.props;
const t = useTranslations(lang as 'en' | 'es');

const {
	image = CoffeeImage,
	title = t('contact.title'),
	description = t('contact.description'),
	formAction = "#",
	formMethod = "get"
} = Astro.props;
---

<!-- Contact Modal -->
<div class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="modal-title">
	<div class="contact-modal">
		<div class="modal-columns">
			<div class="modal-column centered">
				<img src={image.src} loading="lazy" alt="Coffee cup illustration representing consultation meeting" class="modal-image" />
				<h3 id="modal-title">{title}</h3>
				<p>{description}</p>
			</div>
			<div class="modal-column">
				<div class="form-block">
					<form id="wf-form-Contact-Form" name="wf-form-Contact-Form" data-name="Contact Form" method={formMethod} class="form" action={formAction} aria-label="Contact form">
						<div class="field-wrapper">
							<label for="modal-name" class="field-label">{t('contact.form.nameLabel')}</label>
							<input class="text-field" maxlength="256" name="Name" data-name="Name" placeholder={t('contact.form.namePlaceholder')} type="text" id="modal-name" aria-required="false" autocomplete="name" />
						</div>

						<div class="field-wrapper">
							<label for="modal-email" class="field-label">{t('contact.form.emailLabel')}</label>
							<input class="text-field" maxlength="256" name="Email" data-name="Email" placeholder={t('contact.form.emailPlaceholder')} type="email" id="modal-email" required="" aria-required="true" autocomplete="email" aria-describedby="email-help" />
							<span id="email-help" class="field-help-text">{t('contact.form.emailHelp')}</span>
						</div>

						<div class="field-wrapper">
							<label for="modal-message" class="field-label">{t('contact.form.messageLabel')}</label>
							<textarea placeholder={t('contact.form.messagePlaceholder')} maxlength="5000" id="modal-message" name="Message" data-name="Message" required="" class="textarea" aria-required="true"></textarea>
						</div>

						<label id="modal-optin" class="checkbox-field">
							<input type="checkbox" id="modal-updates" name="Updates" data-name="Updates?" class="checkbox" aria-label={t('contact.form.optinLabel')} />
							<span class="checkbox-label">{t('contact.form.optinLabel')}</span>
						</label>

						<label class="checkbox-field honey-field">
							<input type="checkbox" id="modal-honeypot" name="Not-Human" data-name="Not Human?" class="checkbox" tabindex="-1" aria-hidden="true" />
							<span class="checkbox-label">{t('contact.form.honeypotLabel')}</span>
						</label>

						<input type="submit" data-wait={t('contact.form.submitWait')} id="modal-submit" class="button dark-button" value={t('contact.form.submitButton')} />
					</form>
					<div class="success-message" role="status" aria-live="polite" aria-atomic="true">
						<div>{t('contact.messages.success')}</div>
					</div>
					<div class="error-message" role="alert" aria-live="assertive" aria-atomic="true">
						<div>{t('contact.messages.error')}</div>
					</div>
				</div>
			</div>
		</div>
		<button class="close-modal" aria-label={t('contact.form.closeButton')}>âœ•</button>
	</div>
</div>

<script>
	// Modal functionality
	document.addEventListener('DOMContentLoaded', function() {
		const modalBackdrop = document.querySelector('.modal-backdrop');
		const openModalButtons = document.querySelectorAll('.open-modal');
		const closeModalButton = document.querySelector('.close-modal');

		// Open modal
		openModalButtons.forEach(button => {
			button.addEventListener('click', function(e) {
				e.preventDefault();
				modalBackdrop.classList.add('active');
				document.body.style.overflow = 'hidden';
			});
		});

		// Close modal
		closeModalButton.addEventListener('click', function(e) {
			e.preventDefault();
			modalBackdrop.classList.remove('active');
			document.body.style.overflow = 'auto';
		});

		// Close modal when clicking backdrop
		modalBackdrop.addEventListener('click', function(e) {
			if (e.target === modalBackdrop) {
				modalBackdrop.classList.remove('active');
				document.body.style.overflow = 'auto';
			}
		});

		// Close modal with Escape key
		document.addEventListener('keydown', function(e) {
			if (e.key === 'Escape' && modalBackdrop.classList.contains('active')) {
				modalBackdrop.classList.remove('active');
				document.body.style.overflow = 'auto';
			}
		});
	});
</script>
